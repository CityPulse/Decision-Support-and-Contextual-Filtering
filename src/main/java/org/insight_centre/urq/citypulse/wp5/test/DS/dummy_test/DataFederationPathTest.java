package org.insight_centre.urq.citypulse.wp5.test.DS.dummy_test;

import java.io.IOException;
import java.net.URI;
import java.util.LinkedList;
import java.util.List;
import java.util.concurrent.CountDownLatch;
import java.util.concurrent.TimeUnit;

import javax.websocket.ClientEndpointConfig;
import javax.websocket.Endpoint;
import javax.websocket.EndpointConfig;
import javax.websocket.MessageHandler;
import javax.websocket.Session;

import org.glassfish.tyrus.client.ClientManager;

import citypulse.commons.data.Coordinate;
import citypulse.commons.data.CoordinateParseException;
import citypulse.commons.event_request.DataFederationRequest;
import citypulse.commons.event_request.DataFederationRequest.DataFederationPropertyType;

import com.google.gson.Gson;

/**
 * Test class for the Data Federation component
 *
 * @author Stefano Germano
 * @author Thu-Le Pham
 * @organization INSIGHT@NUIG, Galway, Ireland
 * @email stefano.germano@insight-centre.org
 * @email thule.pham@insight-centre.org
 */
public class DataFederationPathTest {

	private static CountDownLatch messageLatch;

	private static String message_path = "10.1580864 56.147735,10.1579134 56.1478898,10.1571316 56.1486248,10.1560721 56.1483275,10.1559691 56.1482985,"
			+ "10.1558718 56.1482019,10.1553066 56.147856,10.1539538 56.1485603,10.1530389 56.1490447,10.1507527 56.1502595,"
			+ "10.1495063 56.149666,10.1488428 56.1493557,10.1488778 56.1493428,10.148773 56.1493045,10.1487928 56.1492891,"
			+ "10.1486534 56.149088,10.1487025 56.1490487,10.1486695 56.1490211,10.1485742 56.1489903,10.1477887 56.1494544,"
			+ "10.1469023 56.1499329,10.1467035 56.1500824,10.14651 56.1502408,10.1462984 56.1501796,10.1461946 56.1501633,"
			+ "10.1460163 56.1502989,10.1458366 56.1504637,10.14563 56.1506843,10.1455469 56.1508298,10.1454584 56.1509583,"
			+ "10.144997 56.1515036,10.1444043 56.1521933,10.1440636 56.152648,10.1439 56.1528481,10.1437552 56.1530005,"
			+ "10.1436586 56.1531828,10.1435808 56.153259,10.1435191 56.1533068,10.1434145 56.1533376,10.1433046 56.1533391,"
			+ "10.1417945 56.1532156,10.1415209 56.1532002,10.1411105 56.1531902,10.1407457 56.1531843,10.1377121 56.1529975,"
			+ "10.1375218 56.1529626,10.1373366 56.1529467,10.1370845 56.1529238,10.1367508 56.1529031,10.1365467 56.1528946,"
			+ "10.1363618 56.1528864,10.1357334 56.1528538,10.1353678 56.1528306,10.1351245 56.1528286,10.1348628 56.1528347,"
			+ "10.1345686 56.1528377,10.1340992 56.1528227,10.131358 56.1526973,10.1302533 56.152625,10.1298765 56.1525994,"
			+ "10.1292326 56.1525532,10.1284693 56.1524971,10.1281849 56.1524522,10.1278872 56.1524298,10.1277343 56.1524194,"
			+ "10.1275385 56.1524209,10.1270021 56.1523925,10.1265273 56.1523985,10.1262135 56.1524,10.124918 56.1524224,"
			+ "10.1238493 56.1524815,10.1214741 56.1525987,10.1207888 56.1526325,10.1187275 56.1527391,10.1185558 56.1527256,"
			+ "10.118293 56.1527212,10.1180006 56.1527226,10.1178316 56.1527361,10.1177002 56.1527391,10.1168231 56.1526793,"
			+ "10.1162491 56.152645,10.1159728 56.1526405,10.1156107 56.1526435,10.115085 56.1526689,10.114511 56.1526958,"
			+ "10.1138941 56.1527406,10.1132638 56.1528093,10.1130641 56.1528357,10.1130315 56.1526304,10.112703 56.1526471,"
			+ "10.1125615 56.1526762,10.112407 56.1527286,10.1118373 56.1529252,10.1114757 56.1530299,10.1112497 56.1530834,"
			+ "10.1110222 56.1531224,10.1105534 56.1531874,10.1101817 56.1532165,10.1098297 56.1532297,10.1098136 56.1531072,"
			+ "10.1083813 56.1531819,10.1083977 56.153309,10.1080487 56.1533283,10.1071689 56.1533672,10.1065306 56.1533791,"
			+ "10.1054952 56.1533911,10.1049642 56.1533941,10.1044599 56.1533731,10.1042084 56.1533418,10.1040443 56.1533243,"
			+ "10.1034211 56.1532287,10.1026965 56.1531168,10.1024405 56.1530973,10.1021809 56.1531017,10.1013514 56.1531743,"
			+ "10.0999177 56.1533293,10.0990944 56.1534158,10.0989404 56.1534509,10.0988162 56.1534926,10.0986993 56.1535433,"
			+ "10.0985492 56.15368,10.0978599 56.1535467,10.0970298 56.1534597,10.0946089 56.1532886,10.0940557 56.1532346,"
			+ "10.0936227 56.1531825,10.0931178 56.1531756,10.0919419 56.1530978,10.0906976 56.1530153,10.0902475 56.152976,"
			+ "10.089983 56.1529518,10.0889423 56.1528651,10.0885098 56.1528465,10.0880438 56.1528394,10.0867931 56.1527642,"
			+ "10.0850229 56.1526333,10.0781996 56.1521946,10.0774935 56.1521815,10.0762975 56.1522415,10.0761896 56.1522469,"
			+ "10.075466 56.152242,10.074726 56.1521448,10.0740552 56.1519876,10.0734983 56.1518977,10.0732517 56.1518711,"
			+ "10.0732287 56.1519142,10.0732116 56.1519859,10.0724403 56.1519602,10.071677 56.1519607,10.0715469 56.1519572,"
			+ "10.0702522 56.1520037,10.0695054 56.152085,10.0690095 56.152135,10.0667141 56.1523667,10.0667404 56.1524018,"
			+ "10.0665412 56.1524219,10.0641371 56.1525612,10.0608243 56.152663,10.059374 56.1527735,10.0590006 56.1527871,"
			+ "10.0579923 56.1529693,10.0577631 56.152969,10.0572084 56.1529879,10.0568056 56.153043,10.056576 56.153043,"
			+ "10.056078 56.1530019,10.0553776 56.1529542,10.054963 56.1529344,10.0545867 56.1529481,10.0492262 56.1531435,"
			+ "10.0461369 56.1532562,10.0432745 56.1533734,10.0398036 56.1534989,10.0383386 56.153524,10.0372753 56.1534654,"
			+ "10.0362849 56.1533422,10.0346741 56.1531253,10.0327998 56.1528822,10.0325252 56.1528466,10.0322828 56.1533691,"
			+ "10.0321283 56.1537611,10.0320939 56.1538998,10.0319223 56.1538759,10.0316991 56.1538281,10.0313215 56.1536799,"
			+ "10.0312013 56.1536512,10.0310726 56.1536464,10.0306177 56.1536655,10.0304717 56.1536608,10.0303001 56.1536321,"
			+ "10.0295534 56.1535412,10.0286951 56.1534839,10.0286521 56.1541723,10.0284719 56.1543635,10.0282316 56.1545834,"
			+ "10.028017 56.1546933,10.027811 56.154765,10.0270385 56.1549419,10.0266351 56.1550327,10.0256566 56.1553004,"
			+ "10.0254507 56.1553721,10.0253219 56.155463,10.025176 56.1555729,10.0245494 56.1561991,10.0244464 56.1562756,"
			+ "10.0241203 56.1564238,10.0240259 56.1564525,10.023674 56.1565194,10.023425 56.1565481,10.0232791 56.1565481,"
			+ "10.0226869 56.1564811,10.0219058 56.1564094,10.0211677 56.1563664,10.0209445 56.1563521,10.02073 56.1563712,"
			+ "10.0194511 56.1565481,10.0185584 56.1567058,10.018258 56.1567393,10.0174341 56.1567679,10.0164556 56.156811,"
			+ "10.0159234 56.156854,10.015211 56.1569257,10.0147046 56.1569496,10.0139837 56.1569161,10.0132455 56.1568349,"
			+ "10.0126533 56.1567249,10.0124982 56.1566696,10.0123186 56.157007,10.0122842 56.1570356,10.0121297 56.1570356,"
			+ "10.0118006 56.1570344,10.0116697 56.1573015,10.0116788 56.1573652,10.0102395 56.1573188,10.0101365 56.1573332,"
			+ "10.0100764 56.157381,10.0099047 56.1577681,10.009879 56.1578112,10.0094326 56.1578159,10.0091237 56.1578016,"
			+ "10.0084113 56.1577634,10.0080594 56.157749,10.0078036 56.1577433,10.0077074 56.1577586,10.007656 56.1577989,"
			+ "10.0078169 56.1578987,10.0081426 56.1582076,10.0082638 56.1582941,10.0087332 56.1588813,10.0093769 56.1596269,"
			+ "10.009909 56.1605064,10.010261 56.1615818,10.0106729 56.1632785,10.0108789 56.1638759,10.0112823 56.1645688,"
			+ "10.0115656 56.1653048,10.0117201 56.166361,10.011616 56.1670981,10.0115645 56.1672653,10.0111136 56.1684257,"
			+ "10.0107914 56.1693264,10.0104208 56.1703628,10.0101376 56.1709887,10.0096827 56.1716577,10.0091093 56.1723384,"
			+ "10.0036665 56.1778847,10.0034434 56.1781084,10.0033697 56.1781822,10.0030485 56.178434,10.0027444 56.1785206,"
			+ "10.0021949 56.1785346,10.0022764 56.1797239,10.0026592 56.1814979,10.0031242 56.1830096,10.0032601 56.1834516,"
			+ "10.0034291 56.1838445,10.0037922 56.1846888,10.0045475 56.1859928,10.004979 56.1867575,10.0051866 56.1871076,"
			+ "10.0054291 56.1875108,10.0055767 56.187752,10.0066075 56.1894365,10.0083849 56.1922216,10.0087646 56.1928067,"
			+ "10.0094479 56.1941318,10.0100455 56.1948058,10.0107282 56.1952715,10.0111452 56.1955213,10.0115808 56.1957408,"
			+ "10.0128076 56.1963012,10.0135238 56.1967999,10.0138711 56.1971756,10.0141763 56.19775,10.0157784 56.2003312,"
			+ "10.0163141 56.2015264,10.0164484 56.2018493,10.017075 56.2033556,10.0174441 56.2042222,10.0182852 56.2062297,"
			+ "10.0185813 56.2068193,10.0195283 56.2084721,10.0200201 56.2093625,10.0204122 56.2100266,10.0212737 56.2109303,"
			+ "10.0213487 56.2109507,10.0213936 56.2110075,10.0219251 56.2114458,10.0223424 56.2118155,10.0230086 56.2117258,"
			+ "10.0231055 56.211736,10.023214 56.2117833,10.023361 56.2120248,10.0234802 56.21239,10.0235907 56.212668,"
			+ "10.0237592 56.2129969,10.0240567 56.2133513,10.0241632 56.2134364,10.0245626 56.2137919,10.0253648 56.2144865,"
			+ "10.0254506 56.2149638,10.0254214 56.2155321,10.023889 56.2155218,10.0241952 56.2159943,10.0272975 56.2207424,"
			+ "10.0280501 56.221853,10.0294069 56.2239394,10.0294973 56.2240591,10.0296673 56.2241242,10.0297798 56.2242571,"
			+ "10.0298472 56.2243708,10.0298738 56.2244287,10.029904 56.224448,10.0303511 56.2245723,10.0308899 56.2246652,"
			+ "10.0317684 56.2247166,10.0323154 56.2247721,10.0320529 56.2253343,10.0318433 56.2254258,10.0313941 56.2255063,"
			+ "10.0310697 56.2256311,10.0307178 56.2258441,10.0306427 56.2260887,10.0306427 56.2263213,10.0307121 56.2264287,"
			+ "10.0302887 56.2263541,10.0298488 56.2263347,10.0293415 56.2263037,10.0286331 56.2282714,10.0282844 56.228222,"
			+ "10.0281752 56.2285333,10.0285214 56.2285818,10.0282809 56.2291879,10.0279857 56.2300792,10.0279245 56.2307084,"
			+ "10.0279754 56.2310095,10.0276638 56.2310668,10.027578 56.2311622,10.0275994 56.2321641,10.0277067 56.2324503,"
			+ "10.0278569 56.2326769,10.0281144 56.2327366,10.0284955 56.2327253,10.0286264 56.2331202,10.0287839 56.2338326,"
			+ "10.0288839 56.2345275,10.028932 56.2350106,10.0289566 56.2356931,10.028841 56.2363402,10.0281543 56.2381051,"
			+ "10.0280685 56.2385583,10.0281543 56.2391068,10.0281972 56.2397269,10.0282233 56.2403032,10.0282401 56.2410863,"
			+ "10.0281972 56.2413486,10.0281548 56.2416378,10.0278119 56.2431846,10.0277252 56.243781,10.0277252 56.2440672,"
			+ "10.0277282 56.2446381,10.0279383 56.2470925,10.0279983 56.2480367,10.0280688 56.2484633,10.0281408 56.2487792,"
			+ "10.0282252 56.2490263,10.028358 56.2492392,10.0285483 56.2494796,10.0287886 56.2497245,10.0290088 56.2499169,"
			+ "10.0292793 56.2501255,10.0295935 56.2503267,10.0313588 56.2514077,10.0316038 56.2515925,10.0318021 56.2517849,"
			+ "10.0319356 56.2519643,10.03201 56.2521287,10.0320608 56.2523496,10.03203 56.2525676,10.0318876 56.2529095,"
			+ "10.0317649 56.2532241,10.0307882 56.2556868,10.0307194 56.2558925,10.0306863 56.2560599,10.0306956 56.2563105,"
			+ "10.0307816 56.2565911,10.030922 56.2568935,10.0314814 56.2582685,10.031676 56.2586438,10.0318615 56.2589572,"
			+ "10.0318887 56.259007,10.0337047 56.2586154,10.0347405 56.2583941,10.0359692 56.2580935,10.0374056 56.2577421,"
			+ "10.0385236 56.2574984,10.0388913 56.2574609,10.0411035 56.2574569,10.043567 56.2575946,10.0440738 56.2577354,"
			+ "10.0455712 56.2580809,10.0459517 56.2583226,10.0461327 56.2583249,10.0485154 56.2584973,10.0511944 56.2587073,"
			+ "10.0512753 56.2587592,10.0511944 56.2591532,10.0525398 56.2591766,10.0536848 56.259124,10.0539536 56.259113,"
			+ "10.054322 56.2590439,10.0550788 56.2588282,10.0555865 56.2587922,10.0561591 56.259431,10.0565877 56.259874,"
			+ "10.057399 56.2596505,10.0574452 56.2598165,10.0574352 56.2603106,10.0575074 56.260601,10.0575332 56.2607916,"
			+ "10.0575277 56.2609747,10.0576065 56.2609558,10.0577012 56.2609518,10.0577889 56.2609651,10.0578758 56.2609943,"
			+ "10.0580375 56.2609157,10.058812 56.260547,10.0597931 56.261346,10.0599636 56.2612756,10.0600786 56.2611652,"
			+ "10.0601205 56.2610595,10.0601937 56.2607702,10.0602167 56.2606517,10.060268 56.2605878,10.0608182 56.2603867,"
			+ "10.0613966 56.260209,10.0621257 56.2597831,10.0634689 56.2590685,10.0654881 56.2584086,10.0658012 56.2583153,"
			+ "10.0658582 56.2583,10.0660948 56.2582512,10.0663021 56.2582329,10.0665974 56.2582563,10.0669561 56.258309,"
			+ "10.0669669 56.2582511,10.0670173 56.2581484,10.0671125 56.2579835,10.0671961 56.257746,10.0672078 56.2577128,"
			+ "10.0672264 56.2575104,10.0671657 56.2571631,10.0674481 56.2553984,10.0686748 56.2554494,10.0687025 56.2552733,"
			+ "10.0687169 56.2550961,10.0687276 56.2548531,10.068742 56.2546759,10.0687814 56.2545047,10.0688352 56.2543195,"
			+ "10.0689033 56.254198,10.0689929 56.2540447,10.0690717 56.2539043,10.0691391 56.2537785,10.06816 56.2535829,"
			+ "10.0681997 56.2535144,10.0686471 56.2527228,10.0691344 56.2518604,10.0700317 56.250248,10.0707764 56.2489208,"
			+ "10.0712383 56.2481442,10.0716386 56.2476218,10.072317 56.2469927,10.0730752 56.2464559,10.0739962 56.2459362,"
			+ "10.0751442 56.2453355,10.0761558 56.2448062,10.0778204 56.2439591,10.0776868 56.2438842,10.0778244 56.24381,"
			+ "10.0782667 56.2435715,10.0808663 56.2422332,10.0807586 56.2421617,10.0806927 56.2420545,10.0806943 56.2419178,"
			+ "10.0807425 56.2418053,10.081011 56.2414846,10.0812843 56.241238,10.0818502 56.2408324,10.0822607 56.2405869,"
			+ "10.0833034 56.2400373,10.0836732 56.2398497,10.0842326 56.2395513,10.0847021 56.2393333,10.0850204 56.2392243,"
			+ "10.0854159 56.2391493,10.0856859 56.23906,10.0858403 56.2389456,10.0860107 56.238733,10.0864544 56.238045,"
			+ "10.0869106 56.2375678,10.087431 56.2371972,10.0877776 56.2369375,10.087984 56.2367777,10.0881458 56.2366194,"
			+ "10.0883964 56.2363116,10.0885078 56.2361929,10.0886223 56.2361173,10.088811 56.2360399,10.0890002 56.2359836,"
			+ "10.0892566 56.2359453,10.0900549 56.2358129,10.0909925 56.2356546,10.0920786 56.2354741,10.0934618 56.2352608,"
			+ "10.093635 56.2352505,10.0937867 56.2352763,10.0939414 56.235321,10.0940555 56.2354002,10.0948681 56.2349975,"
			+ "10.095425 56.234755,10.0960748 56.2345022,10.0977532 56.2339725,10.1029619 56.2323578,10.1059779 56.231438,"
			+ "10.1059506 56.231391,10.1099046 56.2301255,10.1105816 56.2298746,10.1111101 56.229644,10.1112928 56.2295517,"
			+ "10.1114116 56.2296244,10.1140022 56.2283561,10.1149785 56.227867,10.1153836 56.2276493,10.1155847 56.2275196,"
			+ "10.1158208 56.2273601,10.1160487 56.2271782,10.1163331 56.2269321,10.1165295 56.2267655,10.116623 56.226667,"
			+ "10.1168155 56.2267007,10.1169707 56.2266817,10.1170478 56.2266538,10.1171261 56.2266004,10.1171692 56.2264951,"
			+ "10.1170997 56.2263895,10.1173131 56.2262719,10.1171296 56.2261545,10.116919 56.226144,10.1166404 56.2261478";

	public static void main(final String[] args) {

		try {
			DataFederationPathTest.messageLatch = new CountDownLatch(1);

			final ClientEndpointConfig cec = ClientEndpointConfig.Builder
					.create().build();

			final ClientManager client = ClientManager.createClient();
			client.connectToServer(new Endpoint() {

				@Override
				public void onOpen(final Session session,
						final EndpointConfig config) {
					try {
						session.addMessageHandler(new MessageHandler.Whole<String>() {
							@Override
							public void onMessage(final String message) {
								System.out.println("Received message: "
										+ message);
								DataFederationPathTest.messageLatch.countDown();
							}
						});

						final List<Coordinate> path = new LinkedList<>();
						final String[] split = DataFederationPathTest.message_path
								.split(",");
						for (final String c : split) {
							path.add(new Coordinate(c));
						}
						final List<DataFederationPropertyType> property = new LinkedList<>();
						property.add(DataFederationPropertyType.average_speed);
						session.getBasicRemote().sendText(
								new Gson().toJson(new DataFederationRequest(
										property, path, false, null, null)));

					} catch (final IOException | CoordinateParseException e) {
						e.printStackTrace();
					}
				}
			}, cec, new URI("ws://" + "10.196.2.72:8007" + "/websockets"
					+ "/DataFederation"));
			DataFederationPathTest.messageLatch.await(100, TimeUnit.SECONDS);
		} catch (final Exception e) {
			e.printStackTrace();
		}

	}
}
